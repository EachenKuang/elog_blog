---
password: ""
icon: ""
date: "2023-11-23"
type: Post
category: è¡Œä¸šæ¦‚å¿µ
slug: industry-day63
tags:
  - è¡Œä¸šæ¦‚å¿µ
  - æ–‡å­—
  - æ€è€ƒ
  - MySQL
summary: ""
title: Day63ã€æ¦‚å¿µè§£æã€‘InnoDB Redo Log
status: Published
urlname: 736ee81e-b82a-4b23-acd2-79554d2e1a40
updated: "2023-11-23 05:34:00"
---

# æ•´ç†å®šä¹‰

ä¸­æ–‡åç§°ï¼šé‡åšæ—¥å¿—

è‹±æ–‡åç§°ï¼šRedo Log

![MySQL 5.7ç‰ˆæœ¬](https://image.kuangyichen.com/image/innodb-architecture-5-7.png)

![MySQL 8.0ç‰ˆæœ¬](https://image.kuangyichen.com/image/innodb-architecture-8-0.png)

> ğŸˆ **What is Redo Logï¼Ÿ**  
> **é‡åšæ—¥å¿—ï¼ˆRedo Logï¼‰**æ˜¯ä¸€ç§åŸºäº<u>ç£ç›˜</u>çš„<u>æ•°æ®ç»“æ„</u>ï¼Œç”¨äºåœ¨<u>å´©æºƒæ¢å¤æœŸé—´ä¿®æ­£ç”±ä¸å®Œæ•´äº‹åŠ¡å†™å…¥çš„æ•°æ®</u>ã€‚åœ¨æ­£å¸¸æ“ä½œæœŸé—´ï¼Œé‡åšæ—¥å¿—å¯¹ç”± SQL è¯­å¥æˆ–ä½çº§ API è°ƒç”¨å¯¼è‡´çš„æ›´æ”¹è¡¨æ•°æ®çš„è¯·æ±‚è¿›è¡Œç¼–ç ã€‚åœ¨æ„å¤–å…³é—­ä¹‹å‰æœªå®Œæˆæ›´æ–°æ•°æ®æ–‡ä»¶çš„ä¿®æ”¹å°†åœ¨åˆå§‹åŒ–å’Œæ¥å—è¿æ¥ä¹‹å‰è‡ªåŠ¨é‡æ”¾ã€‚
>
> é‡åšæ—¥å¿—åœ¨ç£ç›˜ä¸Šä»¥<u>é‡åšæ—¥å¿—æ–‡ä»¶</u>çš„å½¢å¼ç‰©ç†è¡¨ç¤ºã€‚å†™å…¥é‡åšæ—¥å¿—æ–‡ä»¶çš„æ•°æ®ä»¥å—å½±å“çš„è®°å½•ä¸ºå•ä½è¿›è¡Œç¼–ç ï¼Œè¿™äº›æ•°æ®ç»Ÿç§°ä¸º**é‡åšï¼ˆRedoï¼‰**ã€‚æ•°æ®é€šè¿‡é‡åšæ—¥å¿—æ–‡ä»¶çš„ä¼ é€’ç”±é€’å¢çš„**LSNï¼ˆæ—¥å¿—åºåˆ—å·ï¼‰**å€¼è¡¨ç¤ºã€‚é‡åšæ—¥å¿—æ•°æ®åœ¨æ•°æ®ä¿®æ”¹å‘ç”Ÿæ—¶è¿½åŠ ï¼Œéšç€æ£€æŸ¥ç‚¹çš„è¿›è¡Œï¼Œæœ€æ—§çš„æ•°æ®å°†è¢«æˆªæ–­ã€‚
>
> é»˜è®¤æƒ…å†µä¸‹**ã€MySQL 8.0.30 ä¹‹å‰ã€‘**ï¼Œé‡åšæ—¥å¿—åœ¨ç£ç›˜ä¸Šä»¥ä¸¤ä¸ªæ–‡ä»¶å‘½åä¸º ib_logfile0 å’Œ ib_logfile1 çš„å½¢å¼è¿›è¡Œç‰©ç†è¡¨ç¤ºã€‚MySQL ä»¥å¾ªç¯æ–¹å¼å‘é‡åšæ—¥å¿—æ–‡ä»¶å†™å…¥æ•°æ®ã€‚é‡åšæ—¥å¿—ä¸­çš„æ•°æ®ä»¥å—å½±å“çš„è®°å½•ä¸ºå•ä½è¿›è¡Œç¼–ç ï¼Œè¿™äº›æ•°æ®ç»Ÿç§°ä¸ºé‡åšã€‚æ•°æ®é€šè¿‡é‡åšæ—¥å¿—çš„ä¼ é€’ç”±é€’å¢çš„ LSNï¼ˆæ—¥å¿—åºåˆ—å·ï¼‰å€¼è¡¨ç¤ºã€‚

# å¤è¿°å±•å¼€

**redo logï¼ˆé‡åšæ—¥å¿—ï¼‰** å®ç°æŒä¹…åŒ–å’ŒåŸå­æ€§ åœ¨ innoDB çš„å­˜å‚¨å¼•æ“ä¸­ï¼Œäº‹åŠ¡æ—¥å¿—é€šè¿‡é‡åš(redo)æ—¥å¿—å’Œ innoDB å­˜å‚¨å¼•æ“çš„æ—¥å¿—ç¼“å†²(InnoDB Log Buffer)å®ç°ã€‚äº‹åŠ¡å¼€å¯æ—¶ï¼Œäº‹åŠ¡ä¸­çš„æ“ä½œï¼Œéƒ½ä¼šå…ˆå†™å…¥å­˜å‚¨å¼•æ“çš„æ—¥å¿—ç¼“å†²ä¸­ï¼Œåœ¨äº‹åŠ¡æäº¤ä¹‹å‰ï¼Œè¿™äº›ç¼“å†²çš„æ—¥å¿—éƒ½éœ€è¦æå‰åˆ·æ–°åˆ°ç£ç›˜ä¸ŠæŒä¹…åŒ–ï¼Œè¿™å°±æ˜¯ DBA ä»¬å£ä¸­å¸¸è¯´çš„â€œæ—¥å¿—å…ˆè¡Œâ€(Write-Ahead Logging)ã€‚ å½“äº‹åŠ¡æäº¤ä¹‹åï¼Œåœ¨ Buffer Pool ä¸­æ˜ å°„çš„æ•°æ®æ–‡ä»¶æ‰ä¼šæ…¢æ…¢åˆ·æ–°åˆ°ç£ç›˜ã€‚æ­¤æ—¶å¦‚æœæ•°æ®åº“å´©æºƒæˆ–è€…å®•æœºï¼Œé‚£ä¹ˆå½“ç³»ç»Ÿé‡å¯è¿›è¡Œæ¢å¤æ—¶ï¼Œå°±å¯ä»¥æ ¹æ® redo log ä¸­è®°å½•çš„æ—¥å¿—ï¼ŒæŠŠæ•°æ®åº“æ¢å¤åˆ°å´©æºƒå‰çš„ä¸€ä¸ªçŠ¶æ€ã€‚æœªå®Œæˆçš„äº‹åŠ¡ï¼Œå¯ä»¥ç»§ç»­æäº¤ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å›æ»šï¼Œè¿™åŸºäºæ¢å¤çš„ç­–ç•¥è€Œå®šã€‚ åœ¨ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™ï¼Œå°±å·²ç»ä¸º[redo log](https://www.zhihu.com/search?q=redo%20log&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A1935044903%7D)åˆ†é…äº†ä¸€å—è¿ç»­çš„å­˜å‚¨ç©ºé—´ï¼Œä»¥é¡ºåºè¿½åŠ çš„æ–¹å¼è®°å½• Redo Logï¼Œé€šè¿‡é¡ºåº IO æ¥æ”¹å–„æ€§èƒ½ã€‚æ‰€æœ‰çš„äº‹åŠ¡å…±äº« redo log çš„å­˜å‚¨ç©ºé—´ï¼Œå®ƒä»¬çš„ Redo Log æŒ‰è¯­å¥çš„æ‰§è¡Œé¡ºåºï¼Œä¾æ¬¡äº¤æ›¿çš„è®°å½•åœ¨ä¸€èµ·ã€‚

## Redo Log File çš„ç»„æˆ

åç§°ï¼š`ib_logfileN`

é»˜è®¤æƒ…å†µä¸‹ï¼š`ib_logfile0`Â andÂ `ib_logfile1`

å¦‚æœæœ‰ N ä¸ªï¼Œåˆ™ä¸º `ib_logfile0`ï¼Œ`ib_logfile1`ï¼Œ`ib_logfile2`ï¼Œâ€¦ `ib_logfileN`ï¼Œ

æœ€å¤š 100 ä¸ªæ–‡ä»¶ï¼Œæ‰€æœ‰æ–‡ä»¶æ€»å®¹é‡æœ€å¤§ä¸º 512GB

## å¦‚ä½•æ›´æ”¹ Redo Log æ–‡ä»¶çš„æ•°é‡æˆ–å¤§å°ï¼Ÿ

æ›´æ”¹ InnoDB é‡åšæ—¥å¿—æ–‡ä»¶çš„æ•°é‡æˆ–å¤§å°çš„æ­¥éª¤å¦‚ä¸‹ï¼š

1. åœæ­¢ MySQL æœåŠ¡å™¨ï¼Œå¹¶ç¡®ä¿å®ƒèƒ½å¤Ÿæ­£å¸¸å…³é—­ï¼Œæ²¡æœ‰å‡ºç°é”™è¯¯ã€‚
2. ç¼–è¾‘`my.cnf`æ–‡ä»¶ä»¥æ›´æ”¹æ—¥å¿—æ–‡ä»¶çš„é…ç½®ã€‚è¦æ›´æ”¹æ—¥å¿—æ–‡ä»¶çš„å¤§å°ï¼Œé…ç½®`innodb_log_file_size`ã€‚è¦å¢åŠ æ—¥å¿—æ–‡ä»¶çš„æ•°é‡ï¼Œé…ç½®`innodb_log_files_in_group`ã€‚
3. å†æ¬¡å¯åŠ¨ MySQL æœåŠ¡å™¨ã€‚

å¦‚æœ InnoDB æ£€æµ‹åˆ°`innodb_log_file_size`ä¸é‡åšæ—¥å¿—æ–‡ä»¶çš„å¤§å°ä¸åŒï¼Œå®ƒä¼šå†™å…¥ä¸€ä¸ªæ—¥å¿—æ£€æŸ¥ç‚¹ï¼Œå…³é—­å¹¶åˆ é™¤æ—§çš„æ—¥å¿—æ–‡ä»¶ï¼Œåˆ›å»ºæ–°çš„è¯·æ±‚å¤§å°çš„æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶æ‰“å¼€æ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚

### `innodb_log_file_size`

| **Command-Line Format**      | `--innodb-log-file-size=#`                                                                                           |
| ---------------------------- | -------------------------------------------------------------------------------------------------------------------- |
| **System Variable**          | [`innodb_log_file_size`](https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_log_file_size) |
| **Scope**                    | Global                                                                                                               |
| **Dynamic**                  | No                                                                                                                   |
| **Type**                     | Integer                                                                                                              |
| **Default Value**            | `50331648` ã€48MBã€‘                                                                                                  |
| **Minimum Value (â‰¥ 5.7.11)** | `4194304`                                                                                                            |
| **Minimum Value (â‰¤ 5.7.10)** | `1048576`                                                                                                            |
| **Maximum Value**            | `512GB / innodb_log_files_in_group`                                                                                  |
| **Unit**                     | bytes                                                                                                                |

[`innodb_log_file_size`](https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_log_file_size)Â  æœ€å°å€¼ ä» **1MB** æ”¹ä¸º **4MB** åœ¨ **MySQL 5.7.11**.

### `innodb_log_files_in_group`

| **Command-Line Format** | `--innodb-log-files-in-group=#`                                                                                                |
| ----------------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| **System Variable**     | [`innodb_log_files_in_group`](https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_log_files_in_group) |
| **Scope**               | Global                                                                                                                         |
| **Dynamic**             | No                                                                                                                             |
| **Type**                | Integer                                                                                                                        |
| **Default Value**       | `2`                                                                                                                            |
| **Minimum Value**       | `2`                                                                                                                            |
| **Maximum Value**       | `100`                                                                                                                          |

> ğŸ”¥ **æ³¨æ„ï¼š**  
> ([`innodb_log_file_size`](https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_log_file_size)Â \*Â [`innodb_log_files_in_group`](https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_log_files_in_group)) çš„å€¼ä¸èƒ½è¶…è¿‡ 512GB.

## ä¼˜åŒ–æŒ‡å—

è€ƒè™‘ä»¥ä¸‹ä¼˜åŒ–é‡åšæ—¥å¿—è®°å½•çš„æŒ‡å—ï¼š

1. **å°†é‡åšæ—¥å¿—æ–‡ä»¶è®¾ç½®å¾—å¾ˆå¤§ï¼Œç”šè‡³å¯ä»¥ä¸ç¼“å†²æ± ä¸€æ ·å¤§**ã€‚å½“ InnoDB å°†é‡åšæ—¥å¿—æ–‡ä»¶å†™æ»¡æ—¶ï¼Œå®ƒå¿…é¡»åœ¨æ£€æŸ¥ç‚¹ä¸­å°†ç¼“å†²æ± çš„ä¿®æ”¹å†…å®¹å†™å…¥ç£ç›˜ã€‚è¾ƒå°çš„é‡åšæ—¥å¿—æ–‡ä»¶ä¼šå¯¼è‡´è®¸å¤šä¸å¿…è¦çš„ç£ç›˜å†™å…¥ã€‚å°½ç®¡è¿‡å»å¤§çš„é‡åšæ—¥å¿—æ–‡ä»¶ä¼šå¯¼è‡´è¾ƒé•¿çš„æ¢å¤æ—¶é—´ï¼Œä½†ç°åœ¨æ¢å¤é€Ÿåº¦æ›´å¿«ï¼Œæ‚¨å¯ä»¥æ”¾å¿ƒä½¿ç”¨å¤§çš„é‡åšæ—¥å¿—æ–‡ä»¶ã€‚
2. é€šè¿‡é…ç½®`innodb_log_file_size`å’Œ`innodb_log_files_in_group`é€‰é¡¹æ¥è®¾ç½®é‡åšæ—¥å¿—æ–‡ä»¶çš„å¤§å°å’Œæ•°é‡ã€‚
3. **è€ƒè™‘å¢åŠ æ—¥å¿—ç¼“å†²åŒºçš„å¤§å°**ã€‚è¾ƒå¤§çš„æ—¥å¿—ç¼“å†²åŒºå¯ä»¥ä½¿å¤§å‹äº‹åŠ¡åœ¨æäº¤ä¹‹å‰æ— éœ€å°†æ—¥å¿—å†™å…¥ç£ç›˜ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨æœ‰æ›´æ–°ã€æ’å…¥æˆ–åˆ é™¤å¤§é‡è¡Œçš„äº‹åŠ¡ï¼Œå¢å¤§æ—¥å¿—ç¼“å†²åŒºå¯ä»¥èŠ‚çœç£ç›˜ I/Oã€‚å¯ä»¥ä½¿ç”¨`innodb_log_buffer_size`é…ç½®é€‰é¡¹æ¥é…ç½®æ—¥å¿—ç¼“å†²åŒºçš„å¤§å°ã€‚
4. é…ç½®`innodb_log_write_ahead_size`é€‰é¡¹ä»¥é¿å…â€œè¯»å†™å†²çªâ€ã€‚è¯¥é€‰é¡¹å®šä¹‰äº†é‡åšæ—¥å¿—çš„é¢„å†™å—å¤§å°ã€‚**å°†\*\***`innodb_log_write_ahead_size`\***\*è®¾ç½®ä¸ºä¸æ“ä½œç³»ç»Ÿæˆ–æ–‡ä»¶ç³»ç»Ÿç¼“å­˜å—å¤§å°ç›¸åŒ¹é…ã€‚**å½“ç”±äºé‡åšæ—¥å¿—çš„é¢„å†™å—å¤§å°ä¸æ“ä½œç³»ç»Ÿæˆ–æ–‡ä»¶ç³»ç»Ÿç¼“å­˜å—å¤§å°ä¸åŒ¹é…è€Œæ— æ³•å®Œå…¨ç¼“å­˜é‡åšæ—¥å¿—å—æ—¶ï¼Œä¼šå‘ç”Ÿè¯»å†™å†²çªã€‚
5. **`innodb_log_write_ahead_size`\*\***çš„æœ‰æ•ˆå€¼æ˜¯ InnoDB æ—¥å¿—æ–‡ä»¶å—å¤§å°ï¼ˆ2 çš„ n æ¬¡æ–¹ï¼‰çš„å€æ•°\*\*ã€‚æœ€å°å€¼ä¸º InnoDB æ—¥å¿—æ–‡ä»¶å—å¤§å°ï¼ˆ512ï¼‰ã€‚å½“æŒ‡å®šæœ€å°å€¼æ—¶ï¼Œä¸ä¼šå‘ç”Ÿé¢„å†™ã€‚æœ€å¤§å€¼ç­‰äº`innodb_page_size`å€¼ã€‚å¦‚æœä¸º`innodb_log_write_ahead_size`æŒ‡å®šçš„å€¼å¤§äº`innodb_page_size`å€¼ï¼Œåˆ™`innodb_log_write_ahead_size`è®¾ç½®å°†è¢«æˆªæ–­ä¸º`innodb_page_size`å€¼ã€‚
6. å¦‚æœå°†`innodb_log_write_ahead_size`å€¼è®¾ç½®å¾—å¤ªä½ï¼Œä¸æ“ä½œç³»ç»Ÿæˆ–æ–‡ä»¶ç³»ç»Ÿç¼“å­˜å—å¤§å°ç›¸æ¯”ï¼Œä¼šå¯¼è‡´è¯»å†™å†²çªã€‚å¦‚æœå°†å€¼è®¾ç½®å¾—å¤ªé«˜ï¼Œå¯èƒ½ä¼šå¯¹æ—¥å¿—æ–‡ä»¶å†™å…¥çš„ fsync æ€§èƒ½äº§ç”Ÿè½»å¾®å½±å“ï¼Œå› ä¸ºå¤šä¸ªå—ä¼šåŒæ—¶è¢«å†™å…¥ã€‚

# ç†è§£ä½“ä¼š

InnoDB çš„é‡åšæ—¥å¿—ï¼ˆRedo Logï¼‰æ˜¯ MySQL æ•°æ®åº“ä¸­çš„ä¸€ä¸ªé‡è¦ç»„ä»¶ï¼Œå®ƒæ˜¯ä¸€ç§æŒä¹…åŒ–å­˜å‚¨æœºåˆ¶ï¼Œç”¨äºè®°å½•æ•°æ®åº“äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å¯¹æ•°æ®çš„æ‰€æœ‰ä¿®æ”¹æ“ä½œã€‚

å®šä¹‰ï¼šé‡åšæ—¥å¿—æ˜¯ä¸€ç§æ—¥å¿—æ–‡ä»¶ï¼Œå®ƒè®°å½•äº†æ‰€æœ‰ä¿®æ”¹æ•°æ®åº“æ•°æ®çš„æ“ä½œï¼Œä»¥ä¾¿åœ¨æ•°æ®åº“å´©æºƒåå¯ä»¥ç”¨æ¥æ¢å¤æ•°æ®ã€‚é‡åšæ—¥å¿—æ˜¯å¾ªç¯å†™å…¥çš„ï¼Œå½“è¾¾åˆ°ä¸€å®šå¤§å°åï¼Œä¼šä»å¤´å¼€å§‹è¦†ç›–æ—§çš„æ—¥å¿—è®°å½•ã€‚

ä½œç”¨ï¼š

1. æ•°æ®æ¢å¤ï¼šåœ¨æ•°æ®åº“å´©æºƒåï¼Œå¯ä»¥é€šè¿‡é‡åšæ—¥å¿—æ¥æ¢å¤æ•°æ®ï¼Œä¿è¯æ•°æ®çš„æŒä¹…æ€§ã€‚
2. æé«˜æ€§èƒ½ï¼šåœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œåªéœ€è¦å°†é‡åšæ—¥å¿—å†™å…¥åˆ°ç£ç›˜ï¼Œè€Œä¸éœ€è¦ç«‹å³å°†ä¿®æ”¹çš„æ•°æ®å†™å…¥åˆ°ç£ç›˜ï¼Œè¿™å¯ä»¥å‡å°‘ç£ç›˜ I/O æ“ä½œçš„æ¬¡æ•°ï¼Œæé«˜æ€§èƒ½ã€‚

> ğŸ”¥ **æ³¨æ„**  
> åœ¨ MySQL 8.0.30 ç‰ˆæœ¬ä¹‹åï¼ŒRedo Log çš„é…ç½®æœ‰äº›è®¸å˜åŒ–ï¼Œå¯ä»¥å‚è€ƒé“¾æ¥ã€‚æœ¬æ–‡ä¸»è¦è®²è§£ä¹‹å‰çš„æƒ…å†µã€‚

# å‚è€ƒ

[MySQL :: MySQL 8.0 Reference Manual :: 15.6.5 Redo Log](https://dev.mysql.com/doc/refman/8.0/en/innodb-redo-log.html)

[MySQL :: MySQL 8.0 Reference Manual :: 8.5.4 Optimizing InnoDB Redo Logging](https://dev.mysql.com/doc/refman/8.0/en/optimizing-innodb-logging.html)
