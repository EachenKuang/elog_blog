---
password: ""
icon: ""
date: "2023-11-18"
type: Post
category: è¡Œä¸šæ¦‚å¿µ
slug: industry-day58
tags:
  - è¡Œä¸šæ¦‚å¿µ
  - æ–‡å­—
  - æ€è€ƒ
  - MySQL
  - æ•°æ®åº“
summary: ""
title: Day58ã€æ¦‚å¿µè§£æã€‘InnoDBæ¶æ„è®¾è®¡
status: Published
urlname: 87f02b71-13f2-4c9c-a648-34dcf7b5a0bd
updated: "2023-11-23 05:34:00"
---

# å‰è¨€

> ğŸ˜„ ä½œä¸º MySQL5.6 ä¹‹åçš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼ŒInnoDB å› å…¶æ”¯æŒäº‹åŠ¡ã€å¤–é”®ç­‰ç‰¹æ€§å¯æ˜¯é£é¡ä¸€æ—¶ï¼Œç°åœ¨ä¹Ÿæ˜¯æ•°æ®åº“ç†è®ºä¸­çš„é¢è¯•å¿…å¤‡è¦ç´ ï¼ŒçŸ¥å…¶ç„¶è¿˜é¡»çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œé‚£ä¹ˆæŒæ¡å…¶æ¶æ„å½“ç„¶ä¹Ÿæ˜¯è‡³å…³é‡è¦ã€‚

# æ•´ç†å®šä¹‰

![MySQL 5.7 InnoDB å­˜å‚¨å¼•æ“æ¶æ„å›¾](https://image.kuangyichen.com/image/innodb-architecture-5-7.png)

![MySQL 8.0 InnoDB å­˜å‚¨å¼•æ“æ¶æ„å›¾](https://image.kuangyichen.com/image/innodb-architecture-8-0.png)

**å·¦è¾¹æ˜¯ InnoDB çš„**[**å†…å­˜æ•°æ®æ¶æ„**](https://dev.mysql.com/doc/refman/8.0/en/innodb-in-memory-structures.html)**ï¼ˆIn-Memory Structureï¼‰ï¼Œå³è¾¹æ˜¯**[**ç£ç›˜æ•°æ®æ¶æ„**](https://dev.mysql.com/doc/refman/8.0/en/innodb-on-disk-structures.html)**ï¼ˆOn-disk Structureï¼‰**

# å¤è¿°å±•å¼€

## InnoDB å†…å­˜ç»“æ„è®¾è®¡

InnoDB ä½œä¸º MySQL çš„ä¸€ä¸ªå­˜å‚¨å¼•æ“ï¼Œå®ƒçš„å†…å­˜ç»“æ„è®¾è®¡ç”¨äºä¼˜åŒ–æ•°æ®å¤„ç†æ€§èƒ½ã€‚InnoDB çš„å†…å­˜ç»“æ„ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

1. **Buffer Pool**ï¼š<u>è¿™æ˜¯ InnoDB æœ€é‡è¦çš„å†…å­˜ç»“æ„ä¹‹ä¸€ï¼Œç”¨äºç¼“å­˜è¡¨æ•°æ®å’Œç´¢å¼•</u>ã€‚å½“ MySQL éœ€è¦è¯»å–æˆ–å†™å…¥æ•°æ®æ—¶ï¼Œå®ƒé¦–å…ˆä¼šæŸ¥çœ‹è¿™äº›æ•°æ®æ˜¯å¦å·²ç»åœ¨ Buffer Pool ä¸­ã€‚å¦‚æœåœ¨ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥ä»å†…å­˜ä¸­è¯»å–æˆ–å†™å…¥ï¼Œé¿å…äº†ç£ç›˜ I/O æ“ä½œï¼Œä»è€Œå¤§å¤§æé«˜äº†æ€§èƒ½ã€‚
2. **Change Buffer**ï¼šChange Buffer æ˜¯ Buffer Pool çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºç¼“å­˜å¯¹äºŒçº§ç´¢å¼•çš„ä¿®æ”¹æ“ä½œã€‚å½“ MySQL éœ€è¦ä¿®æ”¹äºŒçº§ç´¢å¼•æ—¶ï¼Œå®ƒå¯ä»¥å…ˆå°†ä¿®æ”¹æ“ä½œå†™å…¥ Change Bufferï¼Œç„¶ååœ¨åå°æ…¢æ…¢åœ°å°†è¿™äº›ä¿®æ”¹åº”ç”¨åˆ°ç£ç›˜ä¸Šçš„ç´¢å¼•ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ç£ç›˜ I/O æ“ä½œï¼Œæé«˜æ€§èƒ½ã€‚
3. **Adaptive Hash Index**ï¼šè¿™æ˜¯ InnoDB çš„ä¸€ä¸ªä¼˜åŒ–ç‰¹æ€§ï¼Œç”¨äºåŠ é€Ÿå¯¹ Buffer Pool ä¸­æ•°æ®çš„è®¿é—®ã€‚å½“ MySQL åå¤è®¿é—®åŒä¸€æ•°æ®æ—¶ï¼ŒInnoDB ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå“ˆå¸Œç´¢å¼•ï¼Œä½¿å¾— MySQL å¯ä»¥æ›´å¿«åœ°æ‰¾åˆ°è¿™äº›æ•°æ®ã€‚
4. **Log Buffer**ï¼šè¿™æ˜¯ InnoDB çš„å¦ä¸€ä¸ªé‡è¦å†…å­˜ç»“æ„ï¼Œç”¨äºç¼“å­˜äº‹åŠ¡æ—¥å¿—ã€‚å½“ MySQL æ‰§è¡Œä¸€ä¸ªäº‹åŠ¡æ—¶ï¼Œå®ƒä¼šå…ˆå°†äº‹åŠ¡æ—¥å¿—å†™å…¥ Log Bufferï¼Œç„¶ååœ¨é€‚å½“çš„æ—¶æœºå°†è¿™äº›æ—¥å¿—åˆ·æ–°åˆ°ç£ç›˜ä¸Šï¼Œè¿™æ ·å¯ä»¥å‡å°‘ç£ç›˜ I/O æ“ä½œï¼Œæé«˜æ€§èƒ½ã€‚
5. **InnoDB å†…éƒ¨æ•°æ®å­—å…¸**ï¼šInnoDB æœ‰ä¸€ä¸ªå†…éƒ¨çš„æ•°æ®å­—å…¸ï¼Œç”¨äºå­˜å‚¨è¡¨çš„å…ƒæ•°æ®ï¼Œå¦‚è¡¨çš„ç»“æ„ä¿¡æ¯ã€ç´¢å¼•ä¿¡æ¯ç­‰ã€‚

## InnoDB ç£ç›˜ç»“æ„

InnoDB çš„ç£ç›˜ç»“æ„æ˜¯å…¶å¦‚ä½•åœ¨ç£ç›˜ä¸Šå­˜å‚¨æ•°æ®å’Œç´¢å¼•çš„æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯ InnoDB ç£ç›˜ç»“æ„çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼š

1. **è¡¨ï¼ˆTablesï¼‰**ï¼šInnoDB å­˜å‚¨å¼•æ“ä¸­çš„è¡¨æ˜¯è¡Œå¼å­˜å‚¨çš„ï¼Œæ¯ä¸ªè¡¨éƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªèšç°‡ç´¢å¼•æˆ–éèšç°‡ç´¢å¼•ã€‚è¡¨ä¸­çš„æ•°æ®æŒ‰ä¸»é”®é¡ºåºå­˜å‚¨åœ¨èšç°‡ç´¢å¼•ä¸­ã€‚
2. **ç´¢å¼•ï¼ˆIndexesï¼‰**ï¼šInnoDB ä½¿ç”¨ B+æ ‘æ•°æ®ç»“æ„æ¥å®ç°ç´¢å¼•ï¼Œä»¥åŠ å¿«æ•°æ®è®¿é—®é€Ÿåº¦ã€‚æ¯ä¸ªè¡¨è‡³å°‘æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ï¼ˆä¸»é”®ç´¢å¼•ï¼‰ï¼Œä¹Ÿå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªäºŒçº§ç´¢å¼•ã€‚
3. **è¡¨ç©ºé—´ï¼ˆTablespacesï¼‰**ï¼šè¡¨ç©ºé—´æ˜¯ InnoDB å­˜å‚¨æ•°æ®å’Œç´¢å¼•çš„åœ°æ–¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„ InnoDB è¡¨éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªåä¸º ibdata1 çš„ç³»ç»Ÿè¡¨ç©ºé—´ä¸­ï¼Œä½†ç”¨æˆ·ä¹Ÿå¯ä»¥é…ç½® InnoDB ä½¿ç”¨å¤šä¸ªæˆ–å•ç‹¬çš„è¡¨ç©ºé—´ã€‚
4. **åŒå†™ç¼“å†²åŒºï¼ˆDoublewrite Bufferï¼‰**ï¼šåŒå†™ç¼“å†²åŒºæ˜¯ InnoDB ç”¨æ¥ä¿æŠ¤æ•°æ®å®Œæ•´æ€§çš„ä¸€ç§æœºåˆ¶ã€‚åœ¨å°†æ•°æ®é¡µå†™å…¥ç£ç›˜ä¹‹å‰ï¼ŒInnoDB ä¼šå…ˆå°†å…¶å†™å…¥åŒå†™ç¼“å†²åŒºã€‚å¦‚æœåœ¨å†™å…¥è¿‡ç¨‹ä¸­å‘ç”Ÿç³»ç»Ÿå´©æºƒï¼ŒInnoDB å¯ä»¥ä½¿ç”¨åŒå†™ç¼“å†²åŒºä¸­çš„æ•°æ®æ¢å¤æŸåçš„é¡µã€‚
5. **é‡åšæ—¥å¿—ï¼ˆRedo Logï¼‰**ï¼šé‡åšæ—¥å¿—æ˜¯ InnoDB ç”¨æ¥ä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§çš„ä¸€ç§æœºåˆ¶ã€‚åœ¨äº‹åŠ¡æäº¤æ—¶ï¼ŒInnoDB ä¼šå…ˆå°†äº‹åŠ¡çš„ä¿®æ”¹è®°å½•åˆ°é‡åšæ—¥å¿—ï¼Œå¹¶ç¡®ä¿é‡åšæ—¥å¿—è¢«å†™å…¥ç£ç›˜ã€‚å¦‚æœåœ¨äº‹åŠ¡æäº¤åå‘ç”Ÿç³»ç»Ÿå´©æºƒï¼ŒInnoDB å¯ä»¥ä½¿ç”¨é‡åšæ—¥å¿—æ¢å¤æœªå®Œæˆçš„äº‹åŠ¡ã€‚
6. **å›æ»šæ—¥å¿—ï¼ˆUndo Logsï¼‰**ï¼šå›æ»šæ—¥å¿—æ˜¯ InnoDB ç”¨æ¥å®ç°å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰å’Œäº‹åŠ¡å›æ»šçš„ä¸€ç§æœºåˆ¶ã€‚å½“äº‹åŠ¡ä¿®æ”¹æ•°æ®æ—¶ï¼ŒInnoDB ä¼šåœ¨å›æ»šæ—¥å¿—ä¸­ä¿å­˜ä¿®æ”¹å‰çš„æ•°æ®ã€‚å¦‚æœäº‹åŠ¡éœ€è¦å›æ»šï¼Œæˆ–è€…å…¶ä»–äº‹åŠ¡éœ€è¦è¯»å–ä¿®æ”¹å‰çš„æ•°æ®ï¼ŒInnoDB å¯ä»¥ä½¿ç”¨å›æ»šæ—¥å¿—æ¥è·å–è¿™äº›æ•°æ®ã€‚

# ç†è§£ä½“ä¼š

ç†è§£ InnoDB çš„ç»“æ„æ˜¯éå¸¸é‡è¦çš„ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š

1. æ€§èƒ½ä¼˜åŒ–ï¼šç†è§£ InnoDB çš„å†…å­˜å’Œç£ç›˜ç»“æ„å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ MySQL çš„æ€§èƒ½ç“¶é¢ˆï¼Œå¹¶è¿›è¡Œæœ‰æ•ˆçš„ä¼˜åŒ–ã€‚ä¾‹å¦‚ï¼Œç†è§£ Buffer Pool å’Œ Redo Log çš„å·¥ä½œåŸç†å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°é…ç½®è¿™äº›å‚æ•°ï¼Œä»¥æé«˜ MySQL çš„æ€§èƒ½ã€‚
2. æ•°æ®æ¢å¤ï¼šå½“æ•°æ®åº“å‘ç”Ÿæ•…éšœæ—¶ï¼Œç†è§£ InnoDB çš„ç»“æ„å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°è¿›è¡Œæ•°æ®æ¢å¤ã€‚ä¾‹å¦‚ï¼Œç†è§£ Doublewrite Buffer å’Œ Redo Log çš„å·¥ä½œåŸç†å¯ä»¥å¸®åŠ©ä½ æ¢å¤å› ç³»ç»Ÿå´©æºƒè€ŒæŸåçš„æ•°æ®ã€‚
3. äº‹åŠ¡ç®¡ç†ï¼šç†è§£ InnoDB çš„äº‹åŠ¡ç®¡ç†æœºåˆ¶ï¼Œå¦‚ Undo Logs å’Œ MVCCï¼Œå¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£äº‹åŠ¡çš„è¡Œä¸ºï¼Œå¦‚ä½•å¤„ç†å¹¶å‘æ§åˆ¶å’Œäº‹åŠ¡éš”ç¦»ã€‚

> ğŸ’¡ **å¦‚ä½•å­¦ä¹ å‘¢ï¼Ÿ**
>
> - é˜…è¯»å®˜æ–¹æ–‡æ¡£ï¼Œè¿™æ˜¯ç¬¬ä¸€æ‰‹èµ„æ–™ï¼Œä¹Ÿæ˜¯æœ€åŸå§‹çš„èµ„æ–™ï¼š[MySQL :: MySQL 8.0 Reference Manual :: 15.4 InnoDB Architecture](https://dev.mysql.com/doc/refman/8.0/en/innodb-architecture.html)
> - é˜…è¯»ç›¸å…³ä¹¦ç±ï¼Œæœ€å¥½æ˜¯è‹±æ–‡ç‰ˆï¼Œä¸­æ–‡ç‰ˆçš„è¯ä¸€åˆ™éœ€è¦ç¿»è¯‘è¿‡ç¨‹ï¼Œå¯èƒ½è¿‡æ—¶ï¼ŒäºŒåˆ™ç¿»è¯‘è¿‡ç¨‹ä¸­æ²¡æœ‰åŠæ³•åŸæ±åŸå‘³ï¼Œå¯èƒ½ä¼šå¤±å»ä¸€äº›å¹²è´§ï¼Œå¦‚æœæœ‰èƒ½åŠ›çš„è¯æœ€å¥½è¿˜æ˜¯é˜…è¯»è‹±æ–‡ã€‚å¦‚æœè‹±æ–‡åŸºç¡€ç¡®å®ä¸å¥½ï¼Œé‚£è¿˜æ˜¯è¯»ä¸­æ–‡ç‰ˆæœ¬çš„ã€‚
> - å®è·µæ“ä½œï¼Œé™¤äº†ç†è®ºå­¦ä¹ ä¹‹å¤–ï¼Œè¿˜æ˜¯éœ€è¦å®è·µæ“ä½œçš„ã€‚â€å®è·µæ˜¯æ£€éªŒçœŸç†çš„å”¯ä¸€æ ‡å‡†â€œã€‚åœ¨å®é™…è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½èƒ½å¤Ÿå‘ç°æ›´å¤šçº¸ä¸Šæ‰¾ä¸åˆ°çš„ä¸œè¥¿ã€‚
> - æºç å­¦ä¹ ï¼Œè¿™æ˜¯æœ€éš¾çš„ä¸€ç‚¹ï¼Œä¹Ÿæ˜¯æœ€ç›´æ¥çš„ä¸€ç‚¹ï¼Œ`show me code` ã€‚ç»“åˆæºç ï¼Œæ›´èƒ½å¤Ÿä½“ä¼šè®¾è®¡çš„å®é™…å«ä¹‰åœ¨å†…çš„ã€‚

# å‚è€ƒï¼š

[MySQL :: MySQL 8.0 Reference Manual :: 15.4 InnoDB Architecture](https://dev.mysql.com/doc/refman/8.0/en/innodb-architecture.html)
